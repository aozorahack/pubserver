if(!window.console)var console={log:function(){}};!function(a){a.fn.columns=function(c){var d=[],e=Array.prototype.slice.call(arguments,1);return"string"==typeof c?this.each(function(){var b=a.data(this,"columns");if("undefined"==typeof b||!a.isFunction(b[c]))return a.error('No such method "'+c+'" for Columns');var f=b[c].apply(b,e);void 0!==f&&f!==b&&d.push(f)}):this.each(function(){a.data(this,"columns")||a.data(this,"columns",new b(this,c))}),0===d.length?this.data("columns"):1===d.length?d[0]:d};var b=function(b,c){this.$el=a(b),c&&a.extend(this,c),this.VERSION="2.2.2",this.sort=function(){function a(a,b,d){return b=b?-1:1,function(e,f){return e=e[a],f=f[a],c.test(e)&&c.test(f)?(e=new Date(e),e=Date.parse(e),f=new Date(f),f=Date.parse(f)):"undefined"!=typeof d&&(e=d(e),f=d(f)),f>e?-1*b:e>f?1*b:0}}var b=this,c=/^(Jan|January|Feb|February|Mar|March|Apr|April|May|Jun|June|Jul|July|Aug|August|Sep|September|Oct|October|Nov|November|Dec|December|(0?\d{1})|(10|11|12))(-|\s|\/|\.)(0?[1-9]|(1|2)[0-9]|3(0|1))(-|\s|\/|\.|,\s)(19|20)?\d\d$/i;b.total&&b.sortBy&&"undefined"!=typeof b.data[0][b.sortBy]&&b.data.sort(a(b.sortBy,b.reverse))},this.filter=function(){var b=this,c=b.searchableFields.length;if(b.query){var d=new RegExp(b.query,"gi");b.data=a.grep(b.data,function(a){for(var e=0;c>e;e++)if("string"==typeof a[b.searchableFields[e]]){if(a[b.searchableFields[e]].match(d))return!0}else if("number"==typeof a[b.searchableFields[e]]&&a[b.searchableFields[e]]==b.query)return!0;return!1})}b.total=b.data.length},this.paginate=function(){var a=this;a.pages=Math.ceil(a.data.length/a.size),a.page=a.page<=a.pages?a.page:1,a.setRange(),a.data=a.data.slice(a.range.start-1,a.range.end)},this.condition=function(){var a=this,b=[];if(a.schema){for(var c=a.data.length,d=a.schema.length,e=0;c>e;e++){for(var f=a.data[e],g={},h=0;d>h;h++){var i=a.schema[h];if(i.condition&&!i.condition(f[i.key])){g=null;break}g[i.key]=f[i.key]}g&&b.push(g)}a.data=b}},this.chevron=function(a,b){return Mustache.render(a,b)},this.create=function(){function b(){f.thead=[],a.each(f.schema,function(b,c){if(!c.hide){var d={};-1===a.inArray(c.key,f.sortableFields)?d.notSortable=!0:f.sortBy===c.key?f.reverse?d.sortedDown=!0:d.sortedUp=!0:d.sortable=!0,d.key=c.key,d.header=c.header,f.thead.push(d)}})}function c(b,c){var d=[];return b%2===0?d.push('<tr data-columns-row-id="'+b+'" class="'+f.evenRowClass+'">'):d.push('<tr data-columns-row-id="'+b+'" class="'+f.oddRowClass+'">'),a.each(f.schema,function(a,b){b.hide||(b.template?d.push("<td>"+f.chevron(b.template,c)+"</td>"):d.push("<td>"+c[b.key]+"</td>"))}),d.push("</tr>"),d}function d(){var b=[];b.push("<select>"),a.each(f.showRows,function(a,c){var d='<option value="'+c+'"';c===f.size&&(d+='selected="selected"'),d+=">"+c+"</option>",b.push(d)}),b.push("</select>"),f.showRowsMenu=b.join("")}function e(){f.rows=[],f.total?a.each(f.data,function(a,d){0===a&&b(),f.rows.push(c(a,d).join(""))}):f.rows.push('<tr class="'+f.evenRowClass+'"><td colspan="'+f.schema.length+'"><em>No Results</em></td>')}var f=this;f.resetData(),f.searching&&f.filter(),f.sorting&&f.sort(),f.paginating&&f.paginate(),e(),d();var g={prevPage:f.page-1,nextPage:f.page+1,prevPageExists:f.pageExists(f.page-1),nextPageExists:f.pageExists(f.page+1),resultRange:f.range,tableTotal:f.total,showRowsMenu:f.showRowsMenu,rows:f.rows,headers:f.thead,query:f.query,search:f.search,table:f.table};return a.extend(f.view,g),f.plugins&&a.each(f.plugins,function(a,b){"undefined"!=typeof ColumnsPlugins&&"undefined"!=typeof ColumnsPlugins[b]&&ColumnsPlugins[b].create.call(f)}),f.search?(f.$el.html(f.chevron(f.template,f.view)),f.search=!1):(a("[data-columns-table]",f.$el).remove(),f.$el.append(f.chevron(f.template,f.view))),!0},this.init=function(){function b(){f.schema=[],a.each(f.data[0],function(a){f.schema.push({header:a,key:a})})}function c(){f.searchableFields=[],a.each(f.data[0],function(a){f.searchableFields.push(a)})}function d(){f.sortableFields=[],a.each(f.data[0],function(a){f.sortableFields.push(a)})}function e(){a.ajax({url:f.templateFile,async:!1,success:function(a){f.template=a},error:function(){a.error("Template could not be found.")}})}var f=this;a.isArray(f.data)?(f.master=[],f.view={},f.$el.addClass("columns"),f.$el.on("click",".ui-table-sortable",function(b){var c=a(this).data("columns-sortby");f.sortBy===c&&(f.reverse=f.reverse?!1:!0),f.sortBy=c,f.sortHandler(b)}),f.$el.on("click",".ui-table-control-next, .ui-table-control-prev",function(b){f.page=a(this).data("columns-page"),f.pageHandler(b)}),f.$el.on("keyup",".ui-table-search",function(b){f.query=a(this).val(),f.searchHandler(b)}),f.$el.on("change",".ui-table-size select",function(b){f.size=parseInt(a(this).val()),f.sizeHandler(b)}),f.plugins&&a.each(f.plugins,function(a,b){"undefined"!=typeof ColumnsPlugins&&"undefined"!=typeof ColumnsPlugins[b]&&ColumnsPlugins[b].init.call(f)}),f.conditioning&&f.condition(),f.schema||b(),f.searchableFields||c(),f.sortableFields||d(),f.templateFile&&e(),a.extend(f.master,f.data),f.create()):a.error('The "data" parameter must be an array.')},this.init()};b.prototype={evenRowClass:"ui-table-rows-even",oddRowClass:"ui-table-rows-odd",liveSearch:!0,page:1,pages:1,plugins:null,query:null,reverse:!1,pagination:!0,schema:null,search:!0,searchableFields:null,showRows:[5,10,25,50],size:5,sortableFields:null,sortBy:null,table:!0,templateFile:null,template:'<!-- Search Box: Only rendered while search is true --> {{#search}} <div class="ui-columns-search"> <input class="ui-table-search" placeholder="Search" type="text" name="query" data-columns-search="true" value="{{query}}" /> </div> {{/search}} <!-- Search Box: Only rendered while search is true --> <!-- Columns Table: Only rendered while table is true --> {{#table}} <div class="ui-columns-table" data-columns-table="true"> <table class="ui-table"> <!-- Columns Table Head: Headers have 4 possible states (sortable, notSortable, sortedUp, sortedDown) --> <thead> {{#headers}} {{#sortable}} <th id="column-id-{{key}}" class="ui-table-sortable" data-columns-sortby="{{key}}">{{header}}</th> {{/sortable}} {{#notSortable}} <th class="">{{header}}</th> {{/notSortable}} {{#sortedUp}} <th class="ui-table-sort-up ui-table-sortable" data-columns-sortby="{{key}}">{{header}} <span class="ui-arrow">&#x25B2;</span></th> {{/sortedUp}} {{#sortedDown}} <th class="ui-table-sort-down ui-table-sortable" data-columns-sortby="{{key}}">{{header}} <span class="ui-arrow">&#x25BC;</span></th> {{/sortedDown}} {{/headers}} </thead> <!-- Columns Table Head: Headers have 4 possible states (sortable, notSortable, sortedUp, sortedDown) --> <!-- Columns Table Body: Table columns are rendered outside of this template  --> <tbody> {{#rows}} {{{.}}} {{/rows}} </tbody> <!-- Columns Table Body: Table columns are rendered outside of this template  --> </table> <!-- Columns Controls  --> <div class="ui-table-footer"> <span class="ui-table-size">Show rows: {{{showRowsMenu}}}</span> <span class="ui-table-results">Results: <strong>{{resultRange.start}} &ndash; {{resultRange.end}}</strong> of <strong>{{tableTotal}}</strong> </span> <span class="ui-table-controls"> {{#prevPageExists}} <span class="ui-table-control-prev" data-columns-page="{{prevPage}}"> <img src="/images/arrow-left.png"> </span> {{/prevPageExists}} {{^prevPageExists}} <span class="ui-table-control-disabled"> <img src="/images/arrow-left.png"> </span> {{/prevPageExists}} {{#nextPageExists}} <span class="ui-table-control-next" data-columns-page="{{nextPage}}"> <img src="/images/arrow-right.png"> </span> {{/nextPageExists}} {{^nextPageExists}} <span class="ui-table-control-disabled"> <img src="/images/arrow-right.png"> </span> {{/nextPageExists}} </span> </div> <!-- Columns Controls  --> </div> {{/table}} <!-- Columns Table: Only rendered while table is true -->',conditioning:!0,paginating:!0,searching:!0,sorting:!0,pageHandler:function(){this.create()},searchHandler:function(a){this.liveSearch?this.create():"13"==a.keyCode&&this.create()},sizeHandler:function(){this.create()},sortHandler:function(){this.page=1,this.create()},destroy:function(){return this.$el.data("columns",null),this.$el.empty(),!0},getObject:function(){return this},getPage:function(){return this.page},getQuery:function(){return this.query},getRange:function(){return this.range},getRows:function(){return this.rows},getShowRowsMenu:function(){return this.showRowsMenu},getTemplate:function(){return this.template},getThead:function(){return this.thead},getTotal:function(){return this.total},getVersion:function(){return this.VERSION},getView:function(){return this.view},gotoPage:function(a){return this.pageExists(a)?(this.page=a,this.create(),!0):!1},pageExists:function(a){return a>0&&a<=this.pages?!0:!1},resetData:function(a){return this.data=this.master.slice(0),this.data},setMaster:function(b){return a.isArray(b)?(this.master=b,!0):!1},setPage:function(a){return this.page=this.pageExists(a)?a:this.page,this.page},setRange:function(){var a=(this.page-1)*this.size,b=a+this.size<this.total?a+this.size:this.total;this.range={start:a+1,end:b}},setTotal:function(a){return this.total=a,!0},startTime:null,endTime:null,startTimer:function(){var a=new Date;this.startTime=a.getTime()},endTimer:function(){var a=new Date;this.endTime=a.getTime()},getTimer:function(){console.log((this.endTime-this.startTime)/1e3)}}}(jQuery),function(a,b){a.Mustache=b({})}(this,function(a){function b(a){return"function"==typeof a}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a,b){return o.call(a,b)}function e(a){return!d(p,a)}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return q[a]})}function g(b,d){function f(){if(w&&!x)for(;q.length;)delete p[q.pop()];else q=[];w=!1,x=!1}function g(a){if("string"==typeof a&&(a=a.split(s,2)),!n(a)||2!==a.length)throw new Error("Invalid tags: "+a);k=new RegExp(c(a[0])+"\\s*"),l=new RegExp("\\s*"+c(a[1])),m=new RegExp("\\s*"+c("}"+a[1]))}if(!b)return[];var k,l,m,o=[],p=[],q=[],w=!1,x=!1;g(d||a.tags);for(var y,z,A,B,C,D,E=new j(b);!E.eos();){if(y=E.pos,A=E.scanUntil(k))for(var F=0,G=A.length;G>F;++F)B=A.charAt(F),e(B)?q.push(p.length):x=!0,p.push(["text",B,y,y+1]),y+=1,"\n"===B&&f();if(!E.scan(k))break;if(w=!0,z=E.scan(v)||"name",E.scan(r),"="===z?(A=E.scanUntil(t),E.scan(t),E.scanUntil(l)):"{"===z?(A=E.scanUntil(m),E.scan(u),E.scanUntil(l),z="&"):A=E.scanUntil(l),!E.scan(l))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],p.push(C),"#"===z||"^"===z)o.push(C);else if("/"===z){if(D=o.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?x=!0:"="===z&&g(A)}if(D=o.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return i(h(p))}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function i(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function j(a){this.string=a,this.tail=a,this.pos=0}function k(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function l(){this.cache={}}var m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=RegExp.prototype.test,p=/\S/,q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r=/\s*/,s=/\s+/,t=/\s*=/,u=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;j.prototype.eos=function(){return""===this.tail},j.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},j.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},k.prototype.push=function(a){return new k(a,this)},k.prototype.lookup=function(a){var c,d=this.cache;if(a in d)c=d[a];else{for(var e,f,g=this;g;){if(a.indexOf(".")>0)for(c=g.view,e=a.split("."),f=0;null!=c&&f<e.length;)c=c[e[f++]];else c=g.view[a];if(null!=c)break;g=g.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=g(a,b)),d},l.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof k?b:new k(b);return this.renderTokens(d,e,c,a)},l.prototype.renderTokens=function(c,d,e,f){function g(a){return k.render(a,d,e)}for(var h,i,j="",k=this,l=0,m=c.length;m>l;++l)switch(h=c[l],h[0]){case"#":if(i=d.lookup(h[1]),!i)continue;if(n(i))for(var o=0,p=i.length;p>o;++o)j+=this.renderTokens(h[4],d.push(i[o]),e,f);else if("object"==typeof i||"string"==typeof i)j+=this.renderTokens(h[4],d.push(i),e,f);else if(b(i)){if("string"!=typeof f)throw new Error("Cannot use higher-order sections without the original template");i=i.call(d.view,f.slice(h[3],h[5]),g),null!=i&&(j+=i)}else j+=this.renderTokens(h[4],d,e,f);break;case"^":i=d.lookup(h[1]),(!i||n(i)&&0===i.length)&&(j+=this.renderTokens(h[4],d,e,f));break;case">":if(!e)continue;i=b(e)?e(h[1]):e[h[1]],null!=i&&(j+=this.renderTokens(this.parse(i),d,e,i));break;case"&":i=d.lookup(h[1]),null!=i&&(j+=i);break;case"name":i=d.lookup(h[1]),null!=i&&(j+=a.escape(i));break;case"text":j+=h[1]}return j},a.name="mustache.js",a.version="0.8.1",a.tags=["{{","}}"];var w=new l;return a.clearCache=function(){return w.clearCache()},a.parse=function(a,b){return w.parse(a,b)},a.render=function(a,b,c){return w.render(a,b,c)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=f,a.Scanner=j,a.Context=k,a.Writer=l,a}),extract_meta=function(a){return now=new Date,a.map(function(a){return rdate=new Date(a.release_date),a.release_date=rdate.getFullYear()+"-"+(rdate.getMonth()+1)+"-"+rdate.getDate(),now-rdate<6048e5&&(a.release_date='<font color="red">'+a.release_date+"</font>"),a.title='<a href="'+a.card_url+'">'+a.title+"</a>",a.subtitle&&(a.title=a.title+"</br>"+a.subtitle),authors=a.authors.map(function(a){return a.last_name+" "+a.first_name}),a.author=authors.join(", "),a.proofing=a.proofing||"",a})},whatsnew=function(a){$.ajax({url:"/api/v0.1/books?fields=release_date,title,subtitle,card_url,authors,input,proofing&after="+a,dataType:"json",success:function(a){tbl=$("#tbl").columns({data:extract_meta(a),schema:[{header:"公開日",key:"release_date"},{header:"作品名/副題",key:"title"},{header:"著者名",key:"author"},{header:"入力者名",key:"input"},{header:"校正者名",key:"proofing"}],showRows:[10,25,50,100],size:10})}})};